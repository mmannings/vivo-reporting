@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:  <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl:   <http://www.w3.org/2002/07/owl#> .
@prefix vitro: <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#> .
@prefix dynapi: <https://vivoweb.org/ontology/vitro-dynamic-api#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

<https://vivoweb.org/procedure/create_report_generator>
        a                                   dynapi:Procedure ;
        rdfs:label                          "Create report procedure"@en-US ;
        dynapi:hasFirstStep                 <https://vivoweb.org/procedure/create_report/fill_in_report_generation_procedure/step> ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/create_report/parameter/report_generator_uri>  .
        
####################################################################################################################################################################################
####################################################################################################################################################################################

#Fill in report generation procedure

<https://vivoweb.org/procedure/create_report/fill_in_report_generation_procedure/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/create_report/fill_in_report_generation_procedure/n3template> ;
        dynapi:hasNextStep                  <https://vivoweb.org/procedure/create_report/fill_in_construct_query_templates/step> ;
        rdfs:label                          "Fill in report generation procedure"@en-US .

<https://vivoweb.org/procedure/create_report/fill_in_report_generation_procedure/n3template>
        a                                   dynapi:N3Template ;
        dynapi:hasModel                     <https://vivoweb.org/procedure/create_report/parameter/report_generator_configuration_graph_internal> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/current_step_uri> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/report_generator_uri> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/report_param_uri> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/report_generator_name> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/report_generator_description> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/report_generator_operation_uri_internal> ;
        dynapi:N3TextAdditions              
        """
        @prefix dynapi: <https://vivoweb.org/ontology/vitro-dynamic-api#> .
        ?resource_id
        	a                                   dynapi:Procedure ;
        	dynapi:name                         ?report_generator_name ;
        	dynapi:description                  ?report_generator_description ;
        	dynapi:hasFirstStep                 ?current_step_uri ;
                dynapi:providesParameter            ?report_param_uri .
        
	?report_param_uri
		a                                   dynapi:Parameter ;
		dynapi:name                         "report" ;
		dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/binary-file> .
		
	?report_generator_operation_uri
                a                                   dynapi:ReportGenerator ;
        """ .
        
####################################################################################################################################################################################
####################################################################################################################################################################################
#Loop to fill in construct queries and get map name -> graph parameter uri

<https://vivoweb.org/procedure/create_report/fill_in_construct_query_templates/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/create_report/fill_in_construct_query_templates/loop> ;
        dynapi:hasNextStep                  <https://vivoweb.org/procedure/create_report/fill_in_select_query_templates/step> ;
        rdfs:label                          "Fill out provided construct queries"@en-US .

<https://vivoweb.org/procedure/create_report/fill_in_construct_query_templates/loop>
        a                                   dynapi:LoopOperation ;
        #get construct query settings from array
        dynapi:inputDescriptor              <https://vivoweb.org/procedure/create_report/fill_in_construct_query_templates/input_descriptor> ;
        dynapi:conditionDescriptor          <https://vivoweb.org/procedure/create_report/fill_in_construct_query_templates/condition_descriptor> ;
        
        dynapi:outputDescriptor             <https://vivoweb.org/procedure/create_report/fill_in_construct_query_templates/output_descriptor> ;
        dynapi:executableDescriptor         <https://vivoweb.org/procedure/create_report/fill_in_construct_query_templates/executable_descriptor> ;
        
        dynapi:internalParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_int_param> ;
        
        dynapi:internalParameter            <https://vivoweb.org/procedure/create_report/parameter/container/query_graph_names> ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/create_report/parameter/container/query_graph_names> .
        

<https://vivoweb.org/procedure/create_report/fill_in_construct_query_templates/input_descriptor>
        a                                   dynapi:ProcedureDescriptor ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/get_construct_from_container/parameter/container_construct_item> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_int_param> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/container/construct_queries> ;
        dynapi:call                         <https://vivoweb.org/procedure/get_construct_from_container> .

<https://vivoweb.org/procedure/create_report/fill_in_construct_query_templates/condition_descriptor>
        a                                   dynapi:ProcedureDescriptor ;
        dynapi:providesParameter            <https://vivoweb.org/parameter/expected_int_result_1> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_int_param> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/container/construct_queries> ;
        dynapi:call                         <https://vivoweb.org/procedure/contains_construct_item> .
        
<https://vivoweb.org/procedure/create_report/fill_in_construct_query_templates/executable_descriptor>
        a                                   dynapi:ProcedureDescriptor ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/report_generator_configuration_graph> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/current_step_uri> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/container/query_graph_names> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/get_construct_from_container/parameter/container_construct_item> ;
        dynapi:call                         <https://vivoweb.org/procedure/add_report_generator_construct_query> .   

<https://vivoweb.org/procedure/create_report/fill_in_construct_query_templates/output_descriptor>
        a                                   dynapi:ProcedureDescriptor ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_int_param> ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_int_param> ;
        dynapi:call                         <https://vivoweb.org/procedure/increment_integer> . 

<https://vivoweb.org/procedure/increment_integer>
        a                                   dynapi:Procedure ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_int_param> ;
        dynapi:hasFirstStep                 <https://vivoweb.org/procedure/increment_integer/step> .
        
<https://vivoweb.org/procedure/increment_integer/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/increment_integer/sumOperation> .
        
<https://vivoweb.org/procedure/increment_integer/sumOperation>
	a                                   dynapi:SumOperation ;
	dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_increment_param> ;
	dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_int_param> ;
	dynapi:providesParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_int_param> .



#################################################################################################################################################################################### 
#add_report_generator_constuct_query

<https://vivoweb.org/procedure/add_report_generator_construct_query>
        a                                   dynapi:Procedure ;
        dynapi:hasFirstStep                 <https://vivoweb.org/procedure/get_construct_name/step> .

<https://vivoweb.org/procedure/get_construct_name/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasNextStep                  <https://vivoweb.org/procedure/get_construct_description/step> ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/get_construct_name/operation> .
        
<https://vivoweb.org/procedure/get_construct_name/operation>
        a                                   dynapi:ContainerQuery ;
        dynapi:targetContainer              <https://vivoweb.org/procedure/get_construct_from_container/parameter/container_construct_item> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/name_key> ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/create_report/parameter/query_name> .

<https://vivoweb.org/procedure/get_construct_description/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasNextStep                  <https://vivoweb.org/procedure/get_construct_query_text/step> ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/get_construct_description/operation> .
        
<https://vivoweb.org/procedure/get_construct_description/operation>
        a                                   dynapi:ContainerQuery ;
        dynapi:targetContainer              <https://vivoweb.org/procedure/get_construct_from_container/parameter/container_construct_item> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/description_key> ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/create_report/parameter/query_description> .
        
<https://vivoweb.org/procedure/get_construct_query_text/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasNextStep                  <https://vivoweb.org/procedure/report_generator_construct_query_fill_in/step> ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/get_construct_query_text/operation> .
        
<https://vivoweb.org/procedure/get_construct_query_text/operation>
        a                                   dynapi:ContainerQuery ;
        dynapi:targetContainer              <https://vivoweb.org/procedure/get_construct_from_container/parameter/container_construct_item> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/construct_query_key> ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/create_report/parameter/query_text> .
        
<https://vivoweb.org/procedure/report_generator_construct_query_fill_in/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasNextStep                  <https://vivoweb.org/procedure/add_graph_parameter_uri_to_map/step> ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/report_generator_construct_query_fill_in/operation> .
        
<https://vivoweb.org/procedure/report_generator_construct_query_fill_in/operation>
        a                                   dynapi:N3Template ;
        dynapi:hasModel                     <https://vivoweb.org/procedure/create_report/parameter/report_generator_configuration_graph> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/current_step_uri_not_internal> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/next_step_uri> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/operation_uri> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/query_name> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/query_description> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/query_text> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/graph_parameter_uri> ;
        dynapi:N3TextAdditions              
        """
        @prefix dynapi: <https://vivoweb.org/ontology/vitro-dynamic-api#> .
        @prefix rdfs:  <http://www.w3.org/2000/01/rdf-schema#> .
        ?current_step_uri
                a                           dynapi:OperationalStep ;
                dynapi:hasNextStep          ?next_step_uri ;
                dynapi:hasOperation         ?operation_uri .
        
        ?operation_uri
                a                           dynapi:SparqlConstructQuery ;
                rdfs:label                  ?query_name ;
                dynapi:description          ?query_description;
                dynapi:sparqlQueryText      ?query_text ;
                dynapi:providesParameter    ?graph_parameter_uri ;
                dynapi:hasModel             <https://vivoweb.org/ontology/vitro-dynamic-api/model/full_union> .
        
        ?graph_parameter_uri
		a                           dynapi:Model ;
		dynapi:name                 ?query_name ;
		dynapi:hasType              <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/model> .
        
        """ .

<https://vivoweb.org/procedure/add_graph_parameter_uri_to_map/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasNextStep                  <https://vivoweb.org/procedure/assign_next_step_to_current/step> ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/add_graph_parameter_uri_to_map/operation> .
        
<https://vivoweb.org/procedure/add_graph_parameter_uri_to_map/operation>
 	a                                   dynapi:ContainerLoader ;
 	dynapi:targetContainer              <https://vivoweb.org/procedure/create_report/parameter/container/query_graph_names> ;
 	dynapi:keyParameter                 <https://vivoweb.org/procedure/create_report/parameter/query_name> ;
 	dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/graph_parameter_uri> .
 	
<https://vivoweb.org/procedure/assign_next_step_to_current/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/assign_next_step_to_current/operation> .
        
<https://vivoweb.org/procedure/assign_next_step_to_current/operation>
        a                                   dynapi:AssignOperation ;
        dynapi:assignableParameter          <https://vivoweb.org/procedure/create_report/parameter/next_step_uri> ;
        dynapi:targetParameter              <https://vivoweb.org/procedure/create_report/parameter/current_step_uri_not_internal> .
        
#################################################################################################################################################################################### 
#Get construct from a container 

<https://vivoweb.org/procedure/get_construct_from_container>
        a                                   dynapi:Procedure ;
        dynapi:hasFirstStep                 <https://vivoweb.org/procedure/get_construct_from_container/step> ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/get_construct_from_container/parameter/container_construct_item> .
        
<https://vivoweb.org/procedure/get_construct_from_container/step> 
        a                                   dynapi:OperationalStep ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/get_construct_from_container/operation> .
        
<https://vivoweb.org/procedure/get_construct_from_container/operation>
 	a                                   dynapi:ContainerQuery ;
 	dynapi:providesParameter            <https://vivoweb.org/procedure/get_construct_from_container/parameter/container_construct_item> ;
 	dynapi:targetContainer              <https://vivoweb.org/procedure/create_report/parameter/container/construct_queries> ;
 	dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_int_param> .
 	       
####################################################################################################################################################################################      
#Condition procedure

<https://vivoweb.org/procedure/contains_construct_item>
        a                                   dynapi:Procedure ;
        dynapi:providesParameter            <https://vivoweb.org/parameter/default_condition_0_int> ;
        dynapi:hasFirstStep                 <https://vivoweb.org/procedure/contains_construct_item/conditional_step> .
        
<https://vivoweb.org/procedure/contains_construct_item/conditional_step>
        a                                   dynapi:ConditionalStep ;
        dynapi:nextIfSatisfied              <https://vivoweb.org/procedure/contains_construct_item/condition_satisfied_step> ;
        dynapi:hasCondition                 <https://vivoweb.org/procedure/contains_construct_item/condition_container_contains> .
        
<https://vivoweb.org/procedure/contains_construct_item/condition_satisfied_step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/contains_construct_item/addOperation> .
        
<https://vivoweb.org/procedure/contains_construct_item/addOperation>
	a                                   dynapi:SumOperation ;
	dynapi:requiresParameter            <https://vivoweb.org/parameter/add_int_1_param> ;
	dynapi:requiresParameter            <https://vivoweb.org/parameter/default_condition_0_int> ;
	dynapi:providesParameter            <https://vivoweb.org/parameter/default_condition_0_int> .

<https://vivoweb.org/procedure/contains_construct_item/condition_container_contains> 
        a                                   dynapi:ConditionContainerContains ;
        dynapi:targetContainer              <https://vivoweb.org/procedure/create_report/parameter/container/construct_queries> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_int_param> .
        


####################################################################################################################################################################################
####################################################################################################################################################################################
#Loop to fill out select queries

<https://vivoweb.org/procedure/create_report/fill_in_select_query_templates/step>
        a                                   dynapi:OperationalStep ;
        rdfs:label                          "Fill out provided select queries"@en-US ;
        dynapi:hasNextStep                  <https://vivoweb.org/procedure/create_report/fill_in_report_generation_component/step> ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/create_report/fill_in_select_query_templates/loop> .
        
<https://vivoweb.org/procedure/create_report/fill_in_select_query_templates/loop>
        a                                   dynapi:LoopOperation ;
        dynapi:inputDescriptor              <https://vivoweb.org/procedure/create_report/fill_in_select_query_templates/input_descriptor> ;
        dynapi:conditionDescriptor          <https://vivoweb.org/procedure/create_report/fill_in_select_query_templates/condition_descriptor> ;
        dynapi:outputDescriptor             <https://vivoweb.org/procedure/create_report/fill_in_select_query_templates/output_descriptor> ;
        dynapi:executableDescriptor         <https://vivoweb.org/procedure/create_report/fill_in_select_query_templates/executable_descriptor> ;
        
        dynapi:internalParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_int_param> ;
        dynapi:internalParameter            <https://vivoweb.org/procedure/create_report/parameter/container/data_sources> ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/create_report/parameter/container/data_sources> .

<https://vivoweb.org/procedure/create_report/fill_in_select_query_templates/input_descriptor>
        a                                   dynapi:ProcedureDescriptor ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/get_select_from_container/parameter/container_select_item> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_int_param> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/container/select_queries> ;
        dynapi:call                         <https://vivoweb.org/procedure/get_select_from_container> .

<https://vivoweb.org/procedure/create_report/fill_in_select_query_templates/condition_descriptor>
        a                                   dynapi:ProcedureDescriptor ;
        dynapi:providesParameter            <https://vivoweb.org/parameter/expected_int_result_1> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_int_param> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/container/select_queries> ;
        dynapi:call                         <https://vivoweb.org/procedure/contains_select_item> .
        
<https://vivoweb.org/procedure/create_report/fill_in_select_query_templates/executable_descriptor>
        a                                   dynapi:ProcedureDescriptor ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/report_generator_configuration_graph> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/current_step_uri> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/container/data_sources> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/get_select_from_container/parameter/container_select_item> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/container/query_graph_names> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/report_generator_operation_uri> ;
        dynapi:call                         <https://vivoweb.org/procedure/add_report_generator_select_query> .   

<https://vivoweb.org/procedure/create_report/fill_in_select_query_templates/output_descriptor>
        a                                   dynapi:ProcedureDescriptor ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_int_param> ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_int_param> ;
        dynapi:call                         <https://vivoweb.org/procedure/increment_integer> . 

#################################################################################################################################################################################### 
#add_report_generator_select_query
<https://vivoweb.org/procedure/add_report_generator_select_query>
        a                                   dynapi:Procedure ;
        dynapi:hasFirstStep                 <https://vivoweb.org/procedure/get_select_name/step> .

<https://vivoweb.org/procedure/get_select_name/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasNextStep                  <https://vivoweb.org/procedure/get_select_description/step> ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/get_select_name/operation> .
        
<https://vivoweb.org/procedure/get_select_name/operation>
        a                                   dynapi:ContainerQuery ;
        dynapi:targetContainer              <https://vivoweb.org/procedure/get_select_from_container/parameter/container_select_item> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/name_key> ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/create_report/parameter/query_name> .

<https://vivoweb.org/procedure/get_select_description/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasNextStep                  <https://vivoweb.org/procedure/get_select_query_text/step> ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/get_select_description/operation> .
        
<https://vivoweb.org/procedure/get_select_description/operation>
        a                                   dynapi:ContainerQuery ;
        dynapi:targetContainer              <https://vivoweb.org/procedure/get_select_from_container/parameter/container_select_item> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/description_key> ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/create_report/parameter/query_description> .
        
<https://vivoweb.org/procedure/get_select_query_text/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasNextStep                  <https://vivoweb.org/procedure/add_report_generator_select_query/get_graph_name/step> ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/get_select_query_text/operation> .
        
<https://vivoweb.org/procedure/get_select_query_text/operation>
        a                                   dynapi:ContainerQuery ;
        dynapi:targetContainer              <https://vivoweb.org/procedure/get_select_from_container/parameter/container_select_item> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/select_query_key> ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/create_report/parameter/query_text> .
        
<https://vivoweb.org/procedure/add_report_generator_select_query/get_graph_name/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasNextStep                  <https://vivoweb.org/procedure/add_report_generator_select_query/get_graph_uri/step> ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/add_report_generator_select_query/get_graph_name/operation> .
        
<https://vivoweb.org/procedure/add_report_generator_select_query/get_graph_name/operation>
        a                                   dynapi:ContainerQuery ;
        dynapi:targetContainer              <https://vivoweb.org/procedure/get_select_from_container/parameter/container_select_item> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/graph_key> ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/create_report/parameter/graph_name> .       

<https://vivoweb.org/procedure/add_report_generator_select_query/get_graph_uri/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasNextStep                  <https://vivoweb.org/procedure/report_generator_select_query_fill_in/step> ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/add_report_generator_select_query/get_graph_uri/operation> .
        
<https://vivoweb.org/procedure/add_report_generator_select_query/get_graph_uri/operation>
        a                                   dynapi:ContainerQuery ;
        dynapi:targetContainer              <https://vivoweb.org/procedure/create_report/parameter/container/query_graph_names> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/graph_name> ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/create_report/parameter/graph_parameter_uri> .  
        
<https://vivoweb.org/procedure/report_generator_select_query_fill_in/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasNextStep                  <https://vivoweb.org/procedure/report_generator_select_query_fill_in/add_data_source_uri_to_map/step> ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/report_generator_select_query_fill_in/operation> .
        
<https://vivoweb.org/procedure/report_generator_select_query_fill_in/operation>
        a                                   dynapi:N3Template ;
        dynapi:hasModel                     <https://vivoweb.org/procedure/create_report/parameter/report_generator_configuration_graph> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/current_step_uri_not_internal> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/next_step_uri> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/operation_uri> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/query_name> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/query_description> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/query_text> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/data_source_parameter_uri> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/graph_parameter_uri> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/report_generator_operation_uri> ;
        dynapi:N3TextAdditions              
        """
        @prefix dynapi: <https://vivoweb.org/ontology/vitro-dynamic-api#> .
        @prefix rdfs:  <http://www.w3.org/2000/01/rdf-schema#> .
        ?current_step_uri
                a                           dynapi:OperationalStep ;
                dynapi:hasNextStep          ?next_step_uri ;
                dynapi:hasOperation         ?operation_uri .
        
        ?operation_uri
                a                           dynapi:SparqlSelectQuery ;
                rdfs:label                  ?query_name ;
                dynapi:description          ?query_description;
                dynapi:sparqlQueryText      ?query_text ;
                dynapi:providesParameter    ?data_source_parameter_uri ;
                dynapi:hasModel             ?graph_parameter_uri .
        
        ?data_source_parameter_uri
		a                           dynapi:Parameter ;
		dynapi:name                 ?query_name ;
		dynapi:hasType              <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/json> .
        
        ?report_generator_operation_uri dynapi:dataSource ?data_source_parameter_uri .
        
        """ .

<https://vivoweb.org/procedure/report_generator_select_query_fill_in/add_data_source_uri_to_map/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasNextStep                  <https://vivoweb.org/procedure/report_generator_select_query_fill_in/assign_next_step_to_current/step> ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/report_generator_select_query_fill_in/add_data_source_uri_to_map/operation> .
        
<https://vivoweb.org/procedure/report_generator_select_query_fill_in/add_data_source_uri_to_map/operation>
 	a                                   dynapi:ContainerLoader ;
 	dynapi:targetContainer              <https://vivoweb.org/procedure/create_report/parameter/container/data_sources> ;
 	dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/data_source_parameter_uri> .
 	
<https://vivoweb.org/procedure/report_generator_select_query_fill_in/assign_next_step_to_current/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/report_generator_select_query_fill_in/assign_next_step_to_current/operation> .
        
<https://vivoweb.org/procedure/report_generator_select_query_fill_in/assign_next_step_to_current/operation>
        a                                   dynapi:AssignOperation ;
        dynapi:assignableParameter          <https://vivoweb.org/procedure/create_report/parameter/next_step_uri> ;
        dynapi:targetParameter              <https://vivoweb.org/procedure/create_report/parameter/current_step_uri_not_internal> .


#################################################################################################################################################################################### 
#Get select from a container 

<https://vivoweb.org/procedure/get_select_from_container>
        a                                   dynapi:Procedure ;
        dynapi:hasFirstStep                 <https://vivoweb.org/procedure/get_select_from_container/step> ;
        dynapi:providesParameter            <https://vivoweb.org/procedure/get_select_from_container/parameter/container_select_item> .
        
<https://vivoweb.org/procedure/get_select_from_container/step> 
        a                                   dynapi:OperationalStep ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/get_select_from_container/operation> .
        
<https://vivoweb.org/procedure/get_select_from_container/operation>
 	a                                   dynapi:ContainerQuery ;
 	dynapi:providesParameter            <https://vivoweb.org/procedure/get_select_from_container/parameter/container_select_item> ;
 	dynapi:targetContainer              <https://vivoweb.org/procedure/create_report/parameter/container/select_queries> ;
 	dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_int_param> .
 	
####################################################################################################################################################################################  	
#Condition procedure

<https://vivoweb.org/procedure/contains_select_item>
        a                                   dynapi:Procedure ;
        dynapi:providesParameter            <https://vivoweb.org/parameter/default_condition_0_int> ;
        dynapi:hasFirstStep                 <https://vivoweb.org/procedure/contains_select_item/conditional_step> .
        
<https://vivoweb.org/procedure/contains_select_item/conditional_step>
        a                                   dynapi:ConditionalStep ;
        dynapi:nextIfSatisfied              <https://vivoweb.org/procedure/contains_select_item/condition_satisfied_step> ;
        dynapi:hasCondition                 <https://vivoweb.org/procedure/contains_select_item/condition_container_contains> .
        
<https://vivoweb.org/procedure/contains_select_item/condition_satisfied_step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/contains_select_item/addOperation> .
        
<https://vivoweb.org/procedure/contains_select_item/addOperation>
	a                                   dynapi:SumOperation ;
	dynapi:requiresParameter            <https://vivoweb.org/parameter/add_int_1_param> ;
	dynapi:requiresParameter            <https://vivoweb.org/parameter/default_condition_0_int> ;
	dynapi:providesParameter            <https://vivoweb.org/parameter/default_condition_0_int> .

<https://vivoweb.org/procedure/contains_select_item/condition_container_contains> 
        a                                   dynapi:ConditionContainerContains ;
        dynapi:targetContainer              <https://vivoweb.org/procedure/create_report/parameter/container/select_queries> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/iteration_int_param> .

####################################################################################################################################################################################
####################################################################################################################################################################################
#Fill out report generation component

<https://vivoweb.org/procedure/create_report/fill_in_report_generation_component/step>
        a                                   dynapi:OperationalStep ;
        rdfs:label                          "Fill report generation component"@en-US ;
        dynapi:hasNextStep                  <https://vivoweb.org/procedure/create_report/add_to_dynamic_api_model/step> ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/create_report/fill_in_report_generation_component_sources/n3template> .


<https://vivoweb.org/procedure/create_report/fill_in_report_generation_component_sources/n3template>
        a                                   dynapi:N3Template ;
        dynapi:hasModel                     <https://vivoweb.org/procedure/create_report/parameter/report_generator_configuration_graph> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/template_base64> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/current_step_uri> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/report_generator_operation_uri_internal> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/template_param_uri> ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/report_param_uri> ;
        dynapi:N3TextAdditions              
        """
        @prefix dynapi: <https://vivoweb.org/ontology/vitro-dynamic-api#> .
        @prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
        ?current_step_uri
                a                                   dynapi:OperationalStep ;
                dynapi:hasOperation                 ?report_generator_operation_uri .

        ?report_generator_operation_uri 
                dynapi:template                     ?template_param_uri ;
                dynapi:report                       ?report_param_uri .
	
	?template_param_uri
		a                                   dynapi:Parameter ;
		dynapi:isInternal                   "true"^^xsd:boolean ;
		dynapi:name                         "template" ;
		dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/binary-file> ;
		dynapi:defaultValue                 ?template .
		
        """ .

####################################################################################################################################################################################
####################################################################################################################################################################################

<https://vivoweb.org/procedure/create_report/add_to_dynamic_api_model/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasNextStep                  <https://vivoweb.org/procedure/create_report/load_procedure_into_procedure_pool/step> ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/create_report/add_to_dynamic_api_model/operation> .

<https://vivoweb.org/procedure/create_report/add_to_dynamic_api_model/operation>
        a                                   dynapi:ModelWriter ;
        dynapi:additionModel                <https://vivoweb.org/procedure/create_report/parameter/report_generator_configuration_graph_internal> ;
        dynapi:targetModel                  <https://vivoweb.org/ontology/vitro-dynamic-api/model/dynamic_api_abox_assertions> .

####################################################################################################################################################################################
####################################################################################################################################################################################

<https://vivoweb.org/procedure/create_report/load_procedure_into_procedure_pool/step>
        a                                   dynapi:OperationalStep ;
        dynapi:hasOperation                 <https://vivoweb.org/procedure/create_report/load_procedure_into_procedure_pool/operation> .

<https://vivoweb.org/procedure/create_report/load_procedure_into_procedure_pool/operation>
        a                                   dynapi:ProcedurePoolAtomicOperation ;
        dynapi:poolOperationType            "load" ;
        dynapi:requiresParameter            <https://vivoweb.org/procedure/create_report/parameter/report_generator_uri> .
 
####################################################################################################################################################################################
####################################################################################################################################################################################

#Parameters

<https://vivoweb.org/procedure/create_report/parameter/report_generator_description>
        a                                   dynapi:Parameter ;
        dynapi:name                         "report_generator_description" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string-literal> .
        
<https://vivoweb.org/procedure/create_report/parameter/report_generator_name>
        a                                   dynapi:Parameter ;
        dynapi:name                         "report_generator_name" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string-literal> .

<https://vivoweb.org/procedure/create_report/parameter/container/construct_queries>
        a                                   dynapi:Parameter ;
        dynapi:name                         "construct_queries" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/JsonContainerArray> .
        
<https://vivoweb.org/procedure/create_report/parameter/container/select_queries>
        a                                   dynapi:Parameter ;
        dynapi:name                         "select_queries" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/JsonContainerArray> .
        

<https://vivoweb.org/procedure/create_report/parameter/template_base64>
        a                                   dynapi:Parameter ;
        dynapi:name                         "template" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string-literal> .

#INTERNAL

<https://vivoweb.org/procedure/create_report/parameter/name_key>
        a                                   dynapi:Parameter ;
        dynapi:name                         "name_key" ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:defaultValue                 "name" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string> .
        
<https://vivoweb.org/procedure/create_report/parameter/description_key>
        a                                   dynapi:Parameter ;
        dynapi:name                         "description_key" ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:defaultValue                 "description" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string> .
        
<https://vivoweb.org/procedure/create_report/parameter/construct_query_key>
        a                                   dynapi:Parameter ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:defaultValue                 "constructQuery" ;        
        dynapi:name                         "construct_query_key" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string> .

<https://vivoweb.org/procedure/create_report/parameter/select_query_key>
        a                                   dynapi:Parameter ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:defaultValue                 "selectQuery" ;        
        dynapi:name                         "select_query_key" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string> .

<https://vivoweb.org/procedure/create_report/parameter/graph_key>
        a                                   dynapi:Parameter ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:defaultValue                 "graph" ;        
        dynapi:name                         "graph_key" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string> .

<https://vivoweb.org/procedure/create_report/parameter/query_name>
        a                                   dynapi:Parameter ;
        dynapi:name                         "query_name" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string-literal> .

<https://vivoweb.org/procedure/create_report/parameter/graph_name>
        a                                   dynapi:Parameter ;
        dynapi:name                         "graph_name" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string-literal> .

<https://vivoweb.org/procedure/create_report/parameter/query_description>
        a                                   dynapi:Parameter ;
        dynapi:name                         "query_description" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string-literal> .
        
<https://vivoweb.org/procedure/create_report/parameter/query_text>
        a                                   dynapi:Parameter ;
        dynapi:name                         "query_text" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/string-literal> .
        
<https://vivoweb.org/procedure/create_report/parameter/report_generator_configuration_graph>
        a                                   dynapi:Model ;
        dynapi:name                         "report_generator_configuration_graph" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/model> .

<https://vivoweb.org/procedure/create_report/parameter/report_generator_configuration_graph_internal>
        a                                   dynapi:Model ;
        dynapi:name                         "report_generator_configuration_graph" ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/model> .

<https://vivoweb.org/procedure/create_report/parameter/container/query_graph_names>
        a                                   dynapi:Parameter ;
        dynapi:name                         "query_graph_names" ;
        dynapi:defaultValue                 "{}" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/JsonContainer> .
        
<https://vivoweb.org/procedure/create_report/parameter/container/data_sources>
        a                                   dynapi:Parameter ;
        dynapi:name                         "data_source_names" ;
        dynapi:defaultValue                 "[]" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/JsonContainer> .


<https://vivoweb.org/procedure/create_report/parameter/report_generator_uri>
        a                                   dynapi:Parameter ;
        dynapi:name                         "resource_id" ;
        dynapi:defaultValue                 "https://vivoweb.org/procedure/report_generator/,java_uuid_number" ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/generated-uri> .

<https://vivoweb.org/procedure/create_report/parameter/graph_parameter_uri>
        a                                   dynapi:Parameter ;
        dynapi:name                         "graph_parameter_uri" ;
        dynapi:defaultValue                 "https://vivoweb.org/procedure/report_generator/graph_parameter/,java_uuid_number" ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/generated-uri> .

<https://vivoweb.org/procedure/create_report/parameter/data_source_parameter_uri>
        a                                   dynapi:Parameter ;
        dynapi:name                         "data_source_parameter_uri" ;
        dynapi:defaultValue                 "https://vivoweb.org/procedure/report_generator/data_source_parameter/,java_uuid_number" ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/generated-uri> .

<https://vivoweb.org/procedure/create_report/parameter/operation_uri>
        a                                   dynapi:Parameter ;
        dynapi:name                         "operation_uri" ;
        dynapi:defaultValue                 "https://vivoweb.org/procedure/report_generator/operation/,java_uuid_number" ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/generated-uri> .
        
<https://vivoweb.org/procedure/create_report/parameter/report_generator_operation_uri_internal>
        a                                   dynapi:Parameter ;
        dynapi:name                         "report_generator_operation_uri" ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:defaultValue                 "https://vivoweb.org/procedure/report_generator/report_generator_operation/,java_uuid_number" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/generated-uri> . 
        
<https://vivoweb.org/procedure/create_report/parameter/report_generator_operation_uri>
        a                                   dynapi:Parameter ;
        dynapi:name                         "report_generator_operation_uri" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/generated-uri> .  
 
<https://vivoweb.org/procedure/create_report/parameter/current_step_uri>
        a                                   dynapi:Parameter ;
        dynapi:name                         "current_step_uri" ;
        dynapi:defaultValue                 "https://vivoweb.org/procedure/report_generator/step/,java_uuid_number" ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/generated-uri> .

<https://vivoweb.org/procedure/create_report/parameter/current_step_uri_not_internal>
        a                                   dynapi:Parameter ;
        dynapi:name                         "current_step_uri" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/generated-uri> .
        
<https://vivoweb.org/procedure/create_report/parameter/next_step_uri>
        a                                   dynapi:Parameter ;
        dynapi:name                         "next_step_uri" ;
        dynapi:defaultValue                 "https://vivoweb.org/procedure/report_generator/step/,java_uuid_number" ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/generated-uri> .

<https://vivoweb.org/procedure/create_report/parameter/template_param_uri>
        a                                   dynapi:Parameter ;
        dynapi:name                         "template_param_uri" ;
        dynapi:defaultValue                 "https://vivoweb.org/procedure/report_generator/template_param/,java_uuid_number" ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/generated-uri> .

<https://vivoweb.org/procedure/create_report/parameter/report_param_uri>
        a                                   dynapi:Parameter ;
        dynapi:name                         "report_param_uri" ;
        dynapi:defaultValue                 "https://vivoweb.org/procedure/report_generator/report_param/,java_uuid_number" ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/generated-uri> .

<https://vivoweb.org/procedure/create_report/parameter/iteration_int_param>
        a                                   dynapi:Parameter ;
        dynapi:name                         "iteration_param" ;
        dynapi:defaultValue                 "0" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/integer> .
        
<https://vivoweb.org/procedure/create_report/parameter/iteration_increment_param>
        a                                   dynapi:Parameter ;
        dynapi:name                         "int_1" ;
        dynapi:defaultValue                 "1" ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/integer> .
        
<https://vivoweb.org/procedure/get_construct_from_container/parameter/container_construct_item>
        a                                   dynapi:Parameter ;
        dynapi:name                         "item" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/JsonContainer> .
        
<https://vivoweb.org/procedure/get_select_from_container/parameter/container_select_item>
        a                                   dynapi:Parameter ;
        dynapi:name                         "item" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/JsonContainer> .
        
<https://vivoweb.org/parameter/default_condition_0_int>
        a                                   dynapi:Parameter ;
        dynapi:name                         "condition_result" ;
        dynapi:defaultValue                 "0" ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/integer> .
        
<https://vivoweb.org/parameter/expected_int_result_1>
        a                                   dynapi:Parameter ;
        dynapi:name                         "condition_result" ;
        dynapi:defaultValue                 "1" ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/integer> .

<https://vivoweb.org/parameter/add_int_1_param>
        a                                   dynapi:Parameter ;
        dynapi:name                         "int_1" ;
        dynapi:defaultValue                 "1" ;
        dynapi:isInternal                   "true"^^xsd:boolean ;
        dynapi:hasType                      <https://vivoweb.org/ontology/vitro-dynamic-api/parameter/type/integer> .

